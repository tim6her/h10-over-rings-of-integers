% !TeX encoding = UTF-8
% !TeX TS-program = xelatex
% !TeX spellcheck = en_GB
% !TeX root = ../Herbstrith-H10_over_AI.tex

I closely follow the papers of \textcite{Denef1980} and \textcite{Pheidas1988},
whose structure in term heavily depends on the article \citetitle{Davis1973} by
\textcite{Davis1973}. This way, one can prove the undecidability of Hilbert's
tenth problem over rings of algebraic integers in totally real number fields and
number fields with one pair of non-real embeddings and at least one real
embedding in one go. Compare this approach to Sections 6.3 and 7.2 of the
study~\cite{Shlapentokh2007} by Shlapentokh.

\subsection{Finitely many easy lemmas}

We start by defining two sequences, that satisfy Pell's equation stated below.

\begin{equation} \label{eq:Pell}
    x^2 - d y^2 = 1
\end{equation}

Using modified versions of the techniques presented
by~\textcite{Matijasevic1970}, it will be shown that the index \(m\) can be
obtained in a Diophantine way from \(\py_m(a)\) for certain subsequences of the
sequences defined below.

\begin{defin}
  Let \(K\) be an algebraic number field, \(\algint\) its ring of algebraic
  integers and fix \(a ∈ \algint\). One defines \(δ(a) := \sqrt{a^2 - 1}\) and
  \(ε(a) := a + δ(a)\), where we demand that \(-π/2 < \arg δ(a) ≤ π/2\). If
  \(δ(a) \not\in K\) one defines \(\px_m(a), \py_m(a) ∈ \algint\) for \(m ∈ ℕ\)
  by
  \[
    \px_m(a) + δ(a) \py_m(a) = {(ε(a))}^m.
  \]
\end{defin}

This definition includes the case \(K = ℚ\) with \(\algint = ℤ\) of~\cite{Davis1973}. However, I am using the slightly modified notation of~\cite{Denef1980,Pheidas1988}.

Under the assumptions of the definition \(δ(a)\) is a root of the monic
quadratic polynomial
\[
  X^2 - a^2 + 1 ∈ \algint {[X]}.
\]
Therefore, the extension \(K[δ(a)] / K\) is quadratic and \(δ(a) ∈
\algint[{K[δ(a)]}]\). The sequences \(\px_m(a)\) and \(\py_m(a)\) are well
defined for each \(m ∈ ℕ\) as they correspond to the coefficients of
\({(ε(a))}^m\) in \(K[δ(a)]/K\) with respect to the basis \(\lbrace 1,
δ(a)\rbrace\). If the reference is clear, I will omit the dependency on \(a\)
writing \(δ, ε, \px_m\) and \(\py_m\).
% QUESTION
\todo{Why does every number field contain such an element \(a\)?}
In the following the number field \(K[δ(a)]\) will be denoted by \(L\).

\begin{rem}
  As \(L/K\) has degree two, there is exactly one pair of field
  automorphisms\footnote{A field extension of degree two is necessarily normal.}
  on \(L\) preserving \(K\) point-wise, namely \(σ_1^{K}(α + δβ) = α + δβ\) and
  \(σ_2^K(α + δβ) = α - δβ\) for \(α, β ∈ \algint\). The latter will be denoted
  by \(\overline{η} = σ_2^K(η)\) to emphasize the analogy of complex
  conjugation.
\end{rem}

Let me now collect some properties of these sequences. The proofs are
generalized versions of the ones given in~\cite{Davis1973}.

\begin{lem}
  Let \(K\) be an algebraic number field and \(a ∈ \algint\) such that \(δ(a) \not\in K\). Then
  \begin{thmlist}
    \item\label{lem:epsilon is unit} \(ε\) is a unit in \(\algint[L]\), its
    inverse is given by \(ε^{-1} = a - δ = \overline{ε}\), and
    \item \(\px_m, \py_m\) satisfy Pell's equation~\eqref{eq:Pell} for all \(m
    ∈ ℕ\), using \(d = {δ(a)}^2\) as parameter.
  \end{thmlist}
\end{lem}
\begin{proof}
  \begin{plist}
    \item We have \(ε \; (a - δ) = (a + δ) (a - δ) = a^2 - δ^2 = 1\) as desired.
    \item One uses induction on \(m\). If \(m = 0\), the pair \(\px_0 = 1\) and \(\py_0 =
    0\) yields a trivial solution to equation~\eqref{eq:Pell}. Let the claim be
    proven for all pairs \(\px_n, \py_n\) with \(n ≤ m\). Then rewriting the definition
    of \(\px_{m + 1}, \py_{m + 1}\) one obtains
    \[
      \px_{m + 1} + δ \py_{m + 1} = ε^{m + 1} = (\px_m + δ \py_m)ε.
    \]
    Applying the automorphism \(\overline \cdot\) implies
    \[
      \overline{\px_{m + 1} + δ \py_{m + 1}} = \px_{m + 1} - δ \py_{m + 1} = (\px_m - δ \py_m) ε^{-1}
    \]
    and multiplication of both equations yields
    \[
      \px_{m + 1}^2 - d \py_{m + 1}^2 = \overline{\px_{m + 1} + δ \py_{m + 1}} (\px_{m + 1} - δ \py_{m + 1}) = 1
    \]
    as claimed.
  \end{plist}
\end{proof}

The defining equation
\[
  \px_m + δ \py_m = ε^m = {(\px_1 + δ \py_1)}^m
\]
can be seen as an analogue of the trigonometric identity
\[
  \cos m + i \sin m = e^{im} = {(\cos 1 + i \sin 1)}^m,
\]
where \(\px_m\) plays the role of \(\cos m\), \(\py_m\) the one of \(\sin m\), and \(i\) is replaced by \(δ\). In this view Pell's equation~\eqref{eq:Pell} is the analogue of the Pythagorean identity
\[
  {\cos (m)}^2 + {\sin (m)}^2 = 1.
\]

The next lemma proves the identities corresponding to \(\cos m = \Re e^{im}\),
\(\sin m = \Im e^{im}\), and the addition formulas.

\begin{lem}
  Let \(K\) be an algebraic number field and \(a ∈ \algint\) such that \(δ = δ(a) \not\in K\). Then for all \(m, k ∈ ℕ\) one has
  \begin{thmlist}
    \item\label{lem:real part of epsilon}
    \(\px_m = (ε^m + ε^{-m}) / 2\) and \(\py_m = (ε^m - ε^{-m}) / (2 δ)\), as well as,
    \item\label{lem:addition formulas}
    \(\px_{m ± k} = \px_m \px_k ± δ^2 \py_m \py_k\), and
    \(\py_{m ± k} = \px_k \py_m ± \px_m \py_k\).
  \end{thmlist}
\end{lem}
\begin{proof}
  \begin{plist}
    \item In \cref{lem:epsilon is unit} we have seen that \(ε^{-1} =
    \overline{ε}\) and therefore \(ε^{-m} = {\left(\overline{ε}\right)}^m\). Observe that for arbitrary \(α, β ∈ \algint\) we have
    \[
      α + β y + \overline{α + δ β} = 2α \quad \text{and} \quad
      α + β y - \overline{α - δ β} = 2δ β.
    \]
    Now, setting \(α + δ β = ε^m\) yields the claim.
    \item By the defining equation for \(\px_m\) and \(\py_m\) we have
    \begin{align*}
      \px_{m + k} + δ \py_{m + k} &= ε^{m + k} = (\px_m + δ \py_m) (\px_k + δ \py_k) =\\
                            &= (\px_m \px_k + δ^2 \py_m \py_k) + δ (\px_m \py_k + \px_k \py_m)
    \end{align*}
    and thusly
    \begin{align*}
      \px_{m + k} &= \px_m \px_k + δ^2 \py_m \py_k, \\
      \py_{m + k} &= \px_m \py_k + \px_k \py_m.
    \end{align*}
    The identities for \(\px_{m - k}\) and \(\py_{m - k}\) follow analogously.
  \end{plist}
\end{proof}

Setting \(k = 1\) in the lemma above, one obtains \(\px_{m ± 1} = a \px_m ± δ^2 \py_m\)
and \(\py_{m ± 1} = a \py_m ± \px_m\). A further immediate consequence of this lemma is
the subsequent one, which brings divisibility into play.

\begin{lem}
  Let \(K\) be a number field and \(a ∈ \algint\) such that \(δ = δ(a) \not\in K\).
  Then for all \(m, k ∈ ℕ\), \(k ≠ 0\) we have
  \begin{thmlist}
    \item \(\py_m\) divides \(\py_{mk}\) in \(\algint\) and
    \item \(\py_{mk} \equiv k \px_m^{k - 1} \py_m \mod \left(\py_m^3\right)\) in
    \(\algint\) i.e. \(\py_{mk} - k \px_m^{k - 1} \py_m\) is contained in the
    principal ideal generated by \(\py_m^3\) in \(\algint\).
  \end{thmlist}
\end{lem}
\begin{proof}
  \begin{plist}
    \item I argue by induction on \(k\). The claim is trivial if \(k = 1\) and
    \cref{lem:addition formulas} implies that
    \[
      \py_{m(k + 1)} = \px_m \py_{mk} + x{mk} \py_m.
    \]

    If the claim is proven for all factors lower than \(k + 1\), one finds that
    \(\py_m \mid \py_{mk}\) and \(\py_m \mid \py_m\) trivially. As a consequence, \(\py_m \mid
    \py_{m(k + 1)}\).

    \item Again the defining equation yields
    \begin{align*}
      \px_{mk} + δ \py_{mk} &= ε^{mk} = {(\px_m + δ \py_m)}^k = \\
                        &= \sum_{j = 0}^k \binom k j \px_m^{k - j} \py_m^j δ^j \\
      \intertext{and}
      \py_{mk} &= \sum_{\substack{j=0\\ j \text{ odd}}}^k
                \binom k j \px_m^{k - j} \py_m^j δ^{j -1}.
    \end{align*}
    In the equation above all terms for \(j > 1\) are divisible by \(\py_m^3\) and
    thus vanish modulo \(\left(\py_m^3\right)\). The only term remaining is \(k
    \px_m^{k - 1} \py_m\) as claimed.
  \end{plist}
\end{proof}

The next lemma even though being easy to prove provides a valuable tool in
studying the sequences \(\px_m\) and \(\py_m\). It derives a recursive definition and
lets one prove properties of the sequences, by proving them for \(m ∈ \lbrace
0, 1 \rbrace\) and inferring the properties for \(m + 1\) from \(m\) and \(m - 1\).

\begin{lem}\label{lem:recursion for x_m and y_m}
  Let \(K\) be a number field and \(a ∈ \algint\) such that \(δ = δ(a) \not\in
  K\). For \(m > 1\) the following recursive conditions hold in $\algint$.
  \begin{align*}
    \px_{m + 1} &= 2 a \px_m - \px_{m - 1}, & \px_1 = a, \;& \px_0 = 1 \\
    \py_{m + 1} &= 2 a \py_m - \py_{m - 1}, & \py_1 = 1, \;& \py_0 = 0 \\
  \end{align*}
\end{lem}
\begin{proof}
  The initial conditions follow from \(ε = a + δ\) and \(ε^0 = 1\). To prove the
  the difference equations one uses \cref{lem:addition formulas} and obtains
  \begin{align*}
    \px_{m + 1} &= a \px_m + δ^2 \py_m,  &  \py_{m + 1} &= a \py_m + \px_m, \\
    \px_{m - 1} &= a \px_m - δ^2 \py_m,  &  \py_{m - 1} &= a \py_m - \px_m.
  \end{align*}
  Summation yields \(\px_{m + 1} + \px_{m - 1} = 2 a \px_m\) and \(\py_{m + 1} + \py_{m - 1}
  = 2 a \py_m\).
\end{proof}

One applies the previous lemma to prove some congruence conditions.

\begin{lem}
  Let \(K\) be a number field and \(a, b, c ∈ \algint\) such that \(δ(a), δ(b)
  \not\in K\). Then for all \(m ∈ ℕ\) the following congruences hold in
  $\algint$.
  \begin{plist}
    \item \(\py_m (a) \equiv m \mod (a - 1)\)
    \item If \(a \equiv b \mod (c)\), then \(\px_m (a) \equiv \px_m (b) \mod (c)\) and
    \(\py_m(a) \equiv \py_m(b) \mod (c)\).
  \end{plist}
\end{lem}
\begin{proof}
  Both congruences become equalities if \(m = 0\). As for \(m = 1\),
  the first congruence is again an equality as \(\py_1 (a) = 1\) independently of
  \(a\). The second claim is trivial since \(x_1 (η) = η\) and \(\py_1 (η) = 1\) for \(η
  ∈ \lbrace a, b \rbrace\). At this point one proceeds inductively and assumes
  the claims to be proven for all indices lower than \(m + 1\).

  \begin{plist}
    \item Note that \(a \equiv 1 \mod (a - 1)\) and thusly by
    \cref{lem:recursion for x_m and y_m}
    \[
      \py_{m + 1} = 2 a \py_m - \py_{m - 1} \equiv 2 m - (m - 1) = m + 1 \mod (a - 1)
    \]
    as claimed.

    \item Using \cref{lem:recursion for x_m and y_m} we see that for fixed \(m\)
    the coefficients \(\px_m (η)\) and \(\py_m (η)\) can be expressed as some fixed
    polynomial in \(η\). For the congruence this means
    \begin{align*}
      \px_{m + 1} (a) &= 2 a \px_m (a) - \px_{m - 1} (a)
                     \equiv 2 b \px_m (b) - \px_m{m - 1} (b) = \px_{m + 1} (b)
                     \mod (c)
    \end{align*}
    and for \(\py_{m + 1}\) completely analogously.
  \end{plist}
\end{proof}

\begin{lem}\label{lem:congruence x_2m+k}
  Let \(K\) be a number field and \(a ∈ \algint\) such that \(δ = δ(a) \not\in
  K\). Then for \(m, k ∈ ℕ\) such that \(m ± k ≥ 0\) the following congruence
  holds in $\algint$.
  \[
    \px_{2 m ± k} \equiv - \px_k \mod (\px_m)
  \]
\end{lem}
\begin{proof}
  By applying the addition formulas of \cref{lem:addition formulas} twice and
  using that \(\px_m\) and \(\py_m\) solve Pell's equation~\eqref{eq:Pell} one obtains
  \begin{align*}
    \px_{2m ± k} &= \px_m \px_{m ± k} + δ^2 \py_m \py_{m ± k}
                \equiv δ^2 \py_m (\py_m \px_k ± \px_m \py_k) \equiv\\
               &\equiv δ^2 \py_m^2 \px_k = (\px_m^2 - 1) \px_k
                \equiv -\px_k \mod (\px_m).
  \end{align*}
\end{proof}

At this point for the first time in this section I state a result that is no
direct generalization of a result in~\cite{Davis1973} and present proofs given
in~\cite{Denef1980} or \cite{Shlapentokh2007}. Note however that the results are
nevertheless true for the case \(K = ℚ\) and \(\algint = ℤ\).

\begin{lem}
  Let \(K\) be a number field and \(a ∈ \algint\) such that \(δ = δ(a) \not\in
  K\). Then for all non-negative integers \(k, m ∈ ℕ\) the following congruence
  holds in \(\algint\).
  \[
    \px_{2km} \equiv (-1)^k \mod (\px_m)
  \]
\end{lem}
\begin{proof}
  If \(k = 0\) the congruence becomes and identity and if \(k = 1\) the claim
  follows directly from the lemma above. Assuming the claim to be proven for all
  integers lower than \(k\), we find---by applying \cref{lem:addition formulas}
  twice---that
  \begin{align*}
    \px_{2km} &= \px_{2(k-1)m}\px_{2m} + δ^2 \py_{2 (k-1) m}\py_{2m} \equiv
               (-1)^k + δ^2 \py_{2 (k-1) m}\py_{2m} = \\
              &= (-1)^k + δ^2 \py_{2 (k-1) m} \; 2 \px_m\py_m \equiv
               (-1)^k \mod (\px_m)
  \end{align*}
\end{proof}

% \begin{lem}
%   Let \(K\) be a number field and \(a ∈ \algint\) such that \(δ = δ(a) \not\in K\).
%   Then for all \(η ∈ \algint \setminus \set{0}\) there exists an \(m ∈ ℕ\) such that
%   \(η \mid \py_m\) in \(\algint[{L}]\).
%   % QUESTION
%   \todo{Is \(η \mid y\) in  \(\algint\)?}
% \end{lem}
% \begin{proof}
%   The quotient of the non-trivial, finitely generated \(\algint\)-modules \(\algint[L]\) and \((2 δ η)\)
%   % TODO
%   \todo{Do I need this lemma?}
%
%   Let \(m\) be the order of the group of units in the finite ring
%   \(\algint[L]/(2 δ η)\), where \((2 δ η)\) denotes the principal ideal
%   generated by \(2 δ η\) in \(\algint[{L}]\). Then \(ε^{±m} \equiv 1 \mod (2 δ
%   η)\). Hence, \(2 δ η \mid ε^m - ε^{-m}\) in \(\algint[{L}]\) and therefore
%   \[
%     \left. η \;\middle\vert\; \frac{ε^m - ε^{-m}}{2 δ} \right.
%   \]
%   in \(\algint[{L}]\), where the right hand side equals \(\py_m\) by
%   \cref{lem:real part of epsilon}.
% \end{proof}

\begin{lem}\label{lem:subgroup of ker N L/K}
  Let \(K\) be a number field and \(a ∈ \algint\) such that \(δ = δ(a) \not\in
  K\). Then the set
  \[
    S = \set{α + δ β \mid (α, β) ∈ \algint^2 \text{ is a solution to~\eqref{eq:Pell} with parameter } d = δ^2}
  \]
  is a subgroup of the kernel of the norm map \(N_{L/K}: U_L → U_K\), where \(U_K\) and \(U_L\) denote the groups of units in \(\algint\) and \(\algint[L]\) respectively.
\end{lem}
\begin{proof}
  First of all, note that, if \(α + δ β ∈ S\), so is \(\overline{α + δ β} = α - δ
  β ∈ S\) because
  \[
    α^2 - d {(-β)}^2 = α^2 - d β^2 = 1.
  \]
  Now let \(α + δ β\) be an arbitrary element of \(S\), then
  \[
    N_{L/K}(α + δ β) = (α + δ β) \left(\overline α + δ β \right) = α^2 - d β^2 = 1.
  \]
  This implies that \(α + δ β ∈ \ker N_{L / K}\) but also that \(α + δ β\) is a
  unit, as \(α - δ β\) is its inverse. The product of two arbitrary elements \(α_1 + δ β_1, α_2 + δ β_2 ∈ S\) is
  \[
    (α_1 + δ β_1)(α_2 + δ β_2) = (α_1 α_2 + δ^2 β_1 β_2) + δ (α_1 β_2 + α_2 β_1).
  \]
  We apply the automorphism \(\overline\cdot\) and multiply to obtain
  \begin{align*}
    (α_1 α_2 + δ^2 β_1 β_2)^2 - δ^2 (α_1 β_2 + α_2 β_1)^2 &=
    (α_1 + δ β_1)(α_2 + δ β_2)\,\overline{(α_1 + δ β_1)(α_2 + δ β_2)} =\\
    &=
    (α_1 + δ β_1)\overline{(α_1 + δ β_1)}(α_2 + δ β_2)\overline{(α_2 + δ β_2)} = 1.
  \end{align*}
  As a consequence, \(S\) is closed under multiplication and the claim is
  proven.
\end{proof}

\begin{lem}\label{lem:rank of N_L/K U_L}
  Let \(L\) and \(K\) be number fields as defined above.
  The image \(N_{L / K}\left(U_L\right) ≤ U_K\) has finite index in \(U_K\).
\end{lem}
\begin{proof}
  I claim that \(N_{L / K}\left(U_L\right)\) contains \(α^2\) for every \(α ∈ U_K\).
  This is because the restriction \(σ_i^K|_{\algint}\) is just the identity on
  \(\algint\) for \(i ∈ \set{1, 2}\) and therefore, \(N_{L / K}(α) = α^2\) for all
  \(α ∈ U_K \subseteq U_L\).

  Let now \(k := \rk K\) and identify \(U_K = ℤ_ℓ \times ℤ^{k}\), where \(ℤ_ℓ =
  μ(K)\) is the finite cyclic group of roots of unity in \(K\)
  (cf.~\cref{thm:Dirichlet}). Consider the following \(k\) elements
  \[
    (\overline 0,1,0,…,0), \; (\overline 0,0,1,0,…,0), \; …, \; (\overline 0, 0, …, 0, 1)
  \]
  contained in \(U_K\). By the claim their ‘squares’ are contained in \(N_{L / K}\left(U_L\right)\) i.e.
  \[
    (\overline 0,2,0,…,0), \; (\overline 0,0,2,0,…,0), \; …, \; (\overline 0, 0, …, 0, 2) ∈ N_{L / K}\left(U_L\right).
  \]
  As a consequence, the direct product
  \[
    G := \set{\overline 0} \times \underbrace{2 ℤ \times … \times 2 Z}_{k\text{-times}}
  \]
  is a subgroup of \(N_{L / K}\left(U_L\right)\) and therefore
  \[
    [U_K : N_{L / K}\left(U_L\right)] ≤ [U : G] ≤ ℓ\, 2^k < ∞.
  \]
\end{proof}

As for the free ranks of \(U_K\), \(U_L\), \(N_{L / K}\left(U_L\right)\) and
\(S\) the lemma above implies that \(\rk N_{L / K}\left(U_L\right) = \rk U_K\)
and therefore, as an immediate consequence of the first isomorphism
theorem~\cite[see][II~§1, p.~89]{Lang2002} the following inequality holds
\begin{equation}\label{eq:rank of S} \rk S ≤ \rk \ker N_{L / K} = \rk U_L - \rk
U_K. \end{equation}

Before proving the main theorems of this section (\todo{reference them}) I
sketch how \textcite{Davis1973} proceeds in proving that \textsc{H10} is
undecidable over \(ℤ\).

First he proves using the sequences above that the exponential function is
Diophantine~\cite[Thm 3.3]{Davis1973}. Then he is able to extend the language of
Diophantine predicates by \emph{bounded existential} and \emph{bounded universal
quantifiers} i.e.\ by
\begin{align*}
  {(∃y)}_{≤x}ϕ(x, y) &⇔ ∃y\; (y ≤ x ∧ ϕ(x, y)),\\
  {(∀y)}_{≤x}ϕ(x, y) &⇔ ∀y\; (y > x ∨ ϕ(x, y))
\end{align*}
where \(ϕ\) is a positive existential formula~\cite[Thm 5.1]{Davis1973}. The first
one is easily seen to be Diophantine as the order relation on \(ℕ^{*}\) is
Diophantine. Proving the second claim takes the rest of the section. Now using
this result together with the sequence number theorem~\cite[Thm 1.3]{Davis1973}
Davis proofs that a function is Diophantine if and only if it is computable~\cite[Thm 6.1]{Davis1973}.

This already implies the undecidability of \textsc{H10} over \(ℤ\) as Davis
introduced Diophantine pairing functions in~\cite[Thm 1.1]{Davis1973} and
therefore all domains of Diophantine and therefore all computable functions are
Diophantine. But the domains of computable functions are exactly the
semi-decidable subsets of \(ω\) and we have already met a semi-decidable set
that is not decidable, namely the halting set \(\mathcal{K}\). As a consequence,
there is a Diophantine set that is not decidable, or put differently there
exists a polynomial \(p_{\mathcal{K}} ∈ ℤ[X, \seq{Y}]\), such that for every
Turing machine \(\mathbb A\) there exists an \(α ∈ ℤ\) such that \(\mathbb A\)
cannot correctly decide
\[
  ∃\seq{β}: p_{\mathcal{K}}(α, \seq{β}) = 0.
\]
% TODO
\todo{State the full DPRM-theorem}

\subsection{Diophantine definition of \(ℤ\) over \(K\)}

For the remainder of this section let \(K ≠ ℚ\) be a totally real number field
or a number field with exactly one pair of non-real embeddings of degree \(n :=
[K : ℚ] ≥ 3\) over the rationals \(ℚ\). In the notation of \cref{thm:Dirichlet}
this means that either \(r = n > 1\), or \(r = n - 2 > 0\) and \(s = 1\). As
before we set \(L = K[{δ(a)}]\), where \(δ(a) \not\in \algint\) is a root of
\(X^2 - a^2 + 1\).

Furthermore, let us assume that \(σ_1 = \id_K, σ_2, …, σ_n: K → ℂ\) are all
embeddings of \(K\) into the complex pane \(ℂ\). If \(s = 1\) we demand without
loss of generality that $K, σ_2(K) \not\subset ℝ$ and that $σ_2(α) = α$ for all
\(α ∈ K\). In other words, \((σ_1, σ_2)\) is the pair of complex embeddings and
all other morphisms embed \(K\) into the reals \(ℝ\).

\begin{lem}\label{lem:L over K is quadratic}
  Let \(K ≠ ℚ\) be a number field of degree \(n\) over \(ℚ\). If \(a ∈ \algint\)
  satisfies
  \begin{equation}\label{eq:approximations of a}
    \begin{cases}
      r = n > 0\\
      a > 2^{2(n + 1)}\\
      0 < σ_i(a) < \frac{1}{2} &\text{for } 1 < i ≤ n
    \end{cases}
    \quad \text{or} \quad
    \begin{cases}
      r = n - 2 > 0\\
      |σ_i(a)| > 2^{2(n + 1)} &\text{for } i ∈ \set{1, 2}\\
      0 < σ_i(a) < \frac{1}{2} &\text{for } 2 < i ≤ n
    \end{cases},
  \end{equation}
  then \(δ(a) = \sqrt{a^2 - 1}\) is not contained in \(K\).
\end{lem}
\begin{proof}
  By assumption we have \(0 < σ_n(a) < 1/2\) and therefore \(σ_n(a)^2 - 1 < 0\)
  cannot be a square in the real number field \(σ_n(K) \subseteq ℝ\). As \(K\)
  is isomorphic to \(σ_n(K)\), the algebraic integer \(δ(a) = \sqrt{a^2 - 1}\)
  cannot be contained in \(K\).
\end{proof}

We will prove later using Minkowski's theorem on convex bodies
(\cref{thm:Minkowski}), that an algebraic integer $a ∈ \algint$ satisfying
\eqref{eq:approximations of a} exists and therefore the condition on \(a\) from
the previous section holds.

\begin{rem}
  As the expansion \(L / K\) is quadratic by \cref{lem:L over K is
  quadratic}, every \(σ_i\) can be extended to exactly two embeddings \(σ_{i1}\)
  and \(σ_{i2}\) of \(L\) into the complex plane \(ℂ\) by ‘composing’ with
  \(σ_1^K\) or \(σ_2^K\). This yields
  \begin{equation}\label{eq:def of sigma ij}
    \begin{aligned}
      σ_{i1}(α + δβ) &= σ_i(α) + \sqrt{{σ_i(a)}^2 - 1}\, σ_i(β) \quad \text{and} \\
      σ_{i2}(α + δβ) &= σ_i(α) - \sqrt{{σ_i(a)}^2 - 1}\, σ_i(β)
    \end{aligned}
  \end{equation}
  for all \(α, β ∈ \algint\) and all \(1 ≤ i ≤ n\).
\end{rem}

I will identify the field \(L\) with its embedding \(σ_{11}(L)\) and write \(η\)
instead of \(σ_{11}(η)\) for its elements.

\begin{lem}
  Let \(K ≠ ℚ\) be a number field of degree \(n\) over \(ℚ\) and let \(a ∈
  \algint\) be such that \eqref{eq:approximations of a} is satisfied. Then
  \begin{thmlist}
    \item if \(r = n\), only \(σ_{11}\) and \(σ_{12}\) embed \(L\) into the
    reals, and
    \item if \(r = n - 2\), the field \(L\) is totally complex.
  \end{thmlist}
\end{lem}
\begin{proof}
  \begin{plist}
    \item If \(K\) is totally real and \(i > 1\), then \(0 < σ_i(a) < 1/2\) and
    therefore the radicands in \eqref{eq:def of sigma ij} are both negative. As
    a consequence, \((σ_{i1}, σ_{i2})\) is a pair of non-real embeddings.

    On the other hand, if \(i = 1\) then \(a > 2^{2(n + 1)} > 1\) and the
    radicands are both positive. We deduce that \(σ_{11}\) and \(σ_{12}\) are
    both real embeddings and \(L\) is a subfield of the reals by our
    identification.
    \item As \(σ_1\) and \(σ_2\) are already complex embeddings, so are
    \(σ_{11}, σ_{12}, σ_{21}\) and \(σ_{22}\). For the remaining embeddings one
    argues completely analogously as in (i).
  \end{plist}
\end{proof}

Before we can start proving some approximations for the complex moduli of \(ε,
δ\) and \(a\), we need to fix some notations.

\begin{defin}
  Let \(K ≠ ℚ\) be a number field of degree \(n\) over \(ℚ\) and let \(a ∈
  \algint\) be such that \eqref{eq:approximations of a} is satisfied. For \(1 ≤
  i ≤ n\) we set
  \begin{thmlist}
    \item \(a_i := σ_{i}(a)\),
    \item \(ε_i := σ_{i1}(ε)\) if \(|σ_{i1}(ε)| ≥ 1\) and \(ε_i := σ_{i2}(ε)\)
    otherwise, and
    \item \(δ_i := σ_{i1}(δ)\).
  \end{thmlist}
\end{defin}

\begin{rem}
  \begin{exlist}
    \item Since \(ε\) is a unit [cf.~\cref{lem:epsilon is unit}] and \(σ_{12}(ε)\) is its inverse. The same holds true for all pairs of embeddings \((σ_{i1}, σ_{i2})\). As a consequence,
    \[
      |σ_{i1}(ε)| |σ_{i2}(ε)| = 1,
    \]
    and \(ε_i\) is well defined for all \(1 ≤ i ≤ n\).
    \item Note that by \eqref{eq:def of sigma ij} we have \(σ_{i2}(δ) = -δ_i\)
    and therefore \(|δ_i| = |σ_{i2}(δ)|\) for all \(1 ≤ i ≤ n\).
  \end{exlist}
\end{rem}

\begin{lem}
  Suppose \(K ≠ ℚ\) is a number field of degree \(n\) over \(ℚ\) and let \(a ∈
  \algint\) be such that \eqref{eq:approximations of a} is satisfied.
  Then the following inequalities hold.
  \begin{thmlist}
    \item \(|a_i|/2 < |δ_i| < |a_i| + 1\) for \(0 ≤ i ≤ s + 1\).
    \item \(1/2 < | δ_i | < 1\) for \(s + 1 < i ≤ n\).
    \item If \(η ∈ \ker N_{L/K}\) then \(|σ_{ij}(η)| = 1\) for \(s + 1 < i ≤ n\) and \(j ∈ \set{1, 2}\). Furthermore, \(|η| = 1\) if and only if  \(η\) is a root of unity.
    \item \(\left\vert |a| - \sqrt{|a^2 - 1|} \right\vert < 1\).
    \item \(|a| < |ε_1| < 2|a| + 1\).
    \item \(ε\) is not a root of unity.
  \end{thmlist}
\end{lem}
\begin{proof}
  \begin{plist}
    \item By assumption we have \(|a_i| > 2^{2(n + 1)}\) and therefore
      \[
        \frac{|a_i|^2}{4} = |a_i|^2 - \frac{3a_i^2}{4} ≤ |a_i|^2 - \frac{3}{4} 2^{4(n + 1)} < |a_i|^2 - 1 ≤ |δ_i| = |a_i^2 - 1| ≤ |a_i|^2 + 1 < (|a_i| + 1)^2
      \]
    \item Again by our assumption \(|a_i| < 1/2\). Thus, we find
    \[
      \frac{1}{4} < \frac{3}{4} < 1 - a_i^2 = |δ_i|^2 < 1.
    \]
    \item By assumption all embeddings \((σ_i)_{s + 1 < i ≤ n}\) are real
    embeddings. Thus, in the equation \(σ_{ij}(δ) = ± \sqrt{σ_i(a)^2 - 1}\) the
    radicand is a negative real number, as \(σ_i(a)^2 < 1/4\) by assumption. This
    implies that \(σ_{i1}(δ)\) and \(σ_{i2}(δ)\) are complex conjugate, purely
    imaginary numbers. As a consequence, we find for \(η = α + δβ ∈ \ker
    N_{L/K}\) that
    \begin{align*}
      σ_{i1}(η) &= σ_i(α) + σ_{i1}(δ) σ_i(β)\\
      σ_{i2}(η) &= σ_i(α) + σ_{i2}(δ) σ_i(β) = σ_i(α) - σ_{i1}(δ) σ_i(β)
    \end{align*}
    are complex conjugates. Now on can deduce,
    \[
      1 = N_{L/K}(η) = σ_{i1}(η) σ_{i2}(η) = |σ_{ij}(η)|^2
    \]
    for both \(j = 1\) and \(2\).

    To prove the second part of the claim, we need a fact from number theory:
    \textit{If an algebraic integer \(η\) and all its conjugates have complex
    modulus \(1\), then \(η\) is a root of unity.} A proof of this fact can be
    found in \cite[§~34, Lemma~(a)]{Hecke1981}. Furthermore, note that all roots
    of unity have complex modulus \(1\), so one direction is trivial.

    Let now \(η = α + δ β ∈ \ker N_{L / K}\) and additionally \(|η| = 1\), we
    differentiate two cases. If \(K\) is totally real, then all embeddings of
    the algebraic integer \(η\) have complex modulus \(1\). Therefore, \(η\) is
    a root of unity.

    If on the other hand, there exists a pair of non-real embeddings of \(K\),
    then note firstly, that the complex conjugate \(\overline{δ}\) is a root of the polynomial
    \[
      X^2 - \overline{a}^2 + 1 = X^2 - σ_2(a) + 1.
    \]
    As a consequence, \(σ_{2j}(δ) = (-1)^{1 + j} \overline{δ}\) for \(j ∈ \set{1, 2}\). We deduce that
    \[
      \overline{σ_{11}(η)} = \overline{η} = \overline{α + δ β} = σ_2(α) +
      σ_{21}(δ) σ_{2}(β) = σ_{21}(η)
    \]
    and
    \[
      \overline{σ_{12}(η)} = \overline{α - δ β} = σ_2(α) - σ_{21}(δ) σ_{2}(β)
      = σ_{21}(η) = σ_2(α) + σ_{22}(δ) σ_{2}(β) = σ_{22}(η).
    \]
    This implies that \(|σ_{21}(η)| = |η| = 1\) and
    \(|σ_{22}(η)| = |σ_{12}(η)|\). Finally, note that \(N_{L / ℚ} = N_{K / ℚ}
    \circ N_{L / K}\) and therefore
    \[
      1 = |N_{K / ℚ}(1)| = |N_{K / ℚ} \circ N_{L / K} (η)| = \left\vert \prod_{\substack{1 ≤ i ≤ n\\ 1 ≤ j ≤ 2}} σ_{ij}(η) \right\vert = |σ_{12}(η)| |σ_{22}(η)| = |σ_{12}(η)|^2.
    \]

    \item The inequality
    \[
      0 ≤ \left\vert |a| - \sqrt{|a^2 - 1|} \right\vert < 1
    \]
    is equivalent to \(|a|^2 - 2 |a| + 1 < |a^2 - 1|\). But this equality can easily seen to be satisfied, as
    \[
      |a|^2 + 1 < |a|^2 + 2|a| - 1 = |a^2 - 1| + 2 |a|
    \]
    and the claim is proven.

    \item Consider the inequality
    \[
      |ε_1|^2 = |a + δ_1|^2 = |a^2 + 2 a δ_1 + δ_1^2| ≥ |2a^2 + 2a δ_1| - 1 = 2 |a| |ε_1| - 1
    \]
    which can be rewritten as
    \[
      0 ≤ |ε_1|^2 - 2 |a| |ε_1| + 1 = \left(|ε_1| - |a| - \sqrt{|a|^2 - 1}\right) \left(|ε_1| - |a| + \sqrt{|a|^2 - 1}\right)
    \]
    Thus, either both factors are negative real numbers or both are positive. In the first case
    \[
      0 < |ε_1| < |a| - \sqrt{|a|^2 - 1} \overset{\text{by (iv)}}{<} 1,
    \]
    which is impossible. Hence, both factors are positive and
    \[
      |ε_1| > |a| + \sqrt{|a|^2 - 1}  > |a|,
    \]
    proving the first estimate. The second inequality follows from \(|ε_1| = |a + δ_1| < 2|a| + 1\) by (i).
    % QUESTION
    \todo{Can one get rid of the \(+ 1\)? I doubt the proof of Shlapentokh, but will check, if the stronger estimate is needed.}

    \item Note that by (v), \(|ε_1| > |a| > 2^{2(n + 1)} > 1\) and therefore the
    complex modulus of \(ε\) cannot be equal to \(1\). The claim follows from
    (iii).
  \end{plist}
\end{proof}

% As a next step, we want to show that we have already found all solutions of
% Pell's equation~\eqref{eq:Pell}. For this we need some lemmas.
%
% Recall the group \(S ≤ \ker N_{L / K}\) defined in \cref{lem:subgroup of ker N
% L/K}. We have seen in \cref{lem:rank of N_L/K U_L} and the subsequent
% inequality~\eqref{eq:rank of S} that the free rank of \(S\) can be bound from
% above. Note that \(ε\) is contained in \(S\). Therefore, the following lemma implies
% that \(\rk S\) can be bound from below by \(1\).
%
% \begin{lem}\label{lem:rank of S is greater 0}
%   Let \(K\) be a totally real number field and \(a ∈ \algint\) satisfies \(δ =
%   δ(a) \not\in \algint\) as well as~\eqref{eq:embeddings of a into reals v1}.
%   Then \(ε(a) = ε\) is torsion free i.e.\ there is a group isomorphism \(⟨ε⟩ \cong
%   ℤ\).
% \end{lem}
% \begin{proof}
%   Assume otherwise that \(ε^m = 1\) for some positive integer \(m\) i.e. \(ε\) is an
%   \(m\)-th root of unity. As we have identified \(L\) with a subset of \(ℝ\), this
%   leaves \(±1\) as values for \(ε = 1 + δ\). This is impossible as \(δ \not\in
%   \algint\).
% \end{proof}
%
% As a consequence, of \cref{thm:Dirichlet} we find that
% \[
%   1 ≤ \rk S ≤ \rk U_L - \rk U_K ≤ (n + 1) - n = 1.
% \]
% In other words, we can write every \(η\) in \(S\) as a product \(ζ ε_0^k\), where \(ζ ∈ U_L\) is a root of unity and \(ε_0\)
