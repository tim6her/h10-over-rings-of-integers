% !TeX encoding = UTF-8
% !TeX TS-program = xelatex
% !TeX spellcheck = en_GB
% !TeX root = ../Herbstrith-H10_over_AI.tex

I closely follow the papers of \textcite{Denef1980} and \textcite{Pheidas1988},
whose structure in term heavily depends on the original paper
\citetitle{Davis1973} by \textcite{Davis1973}. This way, one can prove the
undecidability of Hilbert's tenth problem over rings of algebraic integers in
totally real number fields and number fields with one pair of non-real
embeddings in one go.

\subsection{Finitely many easy lemmas}

I start by defining two sequences, that satisfy Pell's equation stated below.

\begin{equation} \label{eq:Pell}
    x^2 - d y^2 = 1
\end{equation}

\begin{defin}
  Let $K$ be an algebraic number field, $\algint$ its ring of algebraic integers
  and fix $a ∈ \algint$. One defines $δ(a) = \sqrt{a^2 - 1}$ and $ε(a) = a +
  δ(a)$. If $δ(a) \not\in K$ one defines $x_m(a), y_m(a) ∈ \algint$ for $m ∈ ℕ$
  by
  \[
    x_m(a) + δ(a) y_m(a) = (ε(a))^m.
  \]
\end{defin}

This definition includes the case $K = ℚ$ with $\algint = ℤ$ of
\cite{Davis1973}. However, I am using the slightly modified notation of
\cite{Denef1980,Pheidas1988}. Note that the sequences $x_m(a)$ and $y_m(a)$ are
well defined for each $m ∈ ℕ$ as they correspond to the coefficients of
$(ε(a))^m$ in $K[δ(a)]/K$ with respect to the basis $\lbrace 1, δ(a)\rbrace$. If
the reference is clear I will omit the dependency on $a$ writing $δ, ε, x_m$
and $y_m$.
% QUESTION
\todo{Why does every number field contain such an element $a$?}

\begin{rem}
  As $K[δ]/K$ has degree two, there is exactly one pair of field
  automorphisms\footnote{A field extension of degree two is necessarily normal.}
  on $K[δ]$ preserving $K$ point-wise, namely $σ_1(α + δβ) = α + δβ$ and $σ_2(α
  + δβ) = α - δβ$ for $α, β ∈ \algint$. The latter will be denoted by
  $\overline{η} = σ_2(η)$ to emphasise the analogy of complex conjugation.
\end{rem}

Let me now collect some properties of these sequences. The proofs are
generalised versions of the ones given in \cite{Davis1973}.

\begin{lem}
  Let $K$ be an algebraic number field and $a ∈ \algint$ such that $δ(a) \not\in K$. Then
  \begin{thmlist}
    \item \label{lem:epsilon is unit}
    $ε$ is a unit in $\algint[K(δ(a))]$, its inverse is given by $ε^{-1} = a - δ = \overline{ε}$, and
    \item $x_m, y_m$ satisfy Pell's equation~\eqref{eq:Pell} for all $m ∈ ℕ$, using $d = δ(a)^2$ as parameter.
  \end{thmlist}
\end{lem}
\begin{proof}
  \begin{plist}
    \item We have $ε \; (a - δ) = (a + δ) (a - δ) = a^2 - δ^2 = 1$ as desired.
    \item One uses induction on $m$. If $m = 0$, the pair $x_0 = 1$ and $y_0 =
    0$ yields a trivial solution to equation~\eqref{eq:Pell}. Let the claim be
    proven for all pairs $x_n, y_n$ with $n ≤ m$. Then rewriting the definition
    of $x_{m + 1}, y_{m + 1}$ one obtains
    \[
      x_{m + 1} + δ y_{m + 1} = ε^{m + 1} = (x_m + δ y_m)ε.
    \]
    Applying the automorphism $\overline \cdot$ implies
    \[
      \overline{x_{m + 1} + δ y_{m + 1}} = x_{m + 1} - δ y_{m + 1} = (x_m - δ y_m) ε^{-1}
    \]
    and multiplication of both equations yields
    \[
      x_{m + 1}^2 - d y_{m + 1}^2 = \overline{x_{m + 1} + δ y_{m + 1}} (x_{m + 1} - δ y_{m + 1}) = 1
    \]
    as claimed.
  \end{plist}
\end{proof}

The defining equation
\[
  x_m + δ y_m = ε^m = (x_1 + δ y_1)^m
\]
can be seen as an analogue of the trigonometric identity
\[
  \cos m + i \sin m = e^{im} = (\cos 1 + i \sin 1)^m,
\]
where $x_m$ plays the role of $\cos m$, $y_m$ the one of $\sin m$, and $i$ is replaced by $δ$. In this view Pell's equation~\eqref{eq:Pell} is the analogue of the Pythagorean identity
\[
  \cos (m) ^2 + \sin (m) ^2 = 1.
\]

The next lemma proves the identities corresponding to $\cos m = \Re e^m$, $\sin
m = \Im e^m$, and the addition formulas.

\begin{lem}
  Let $K$ be an algebraic number field and $a ∈ \algint$ such that $δ = δ(a) \not\in K$. Then for all $m, k ∈ ℕ$ one has
  \begin{thmlist}
    \item \label{lem:real part of epsilon}
    $x_m = (ε^m + ε^{-m}) / 2$ and $y_m = (ε^m - ε^{-m}) / (2 δ)$, as well as,
    \item \label{lem:addition formulas}
    $x_{m ± k} = x_m x_k ± δ^2 y_m y_k$, and
    $y_{m ± k} = x_k y_m ± x_m y_k$.
  \end{thmlist}
\end{lem}
\begin{proof}
  \begin{plist}
    \item In \cref{lem:epsilon is unit} we have seen that $ε^{-1} =
    \overline{ε}$ and therefore $ε^{-m} = \left(\overline{ε}\right)^m$. Observe that for arbitrary $α, β ∈ \algint$ we have
    \[
      α + β y + \overline{α + δ β} = 2α \quad \text{and} \quad
      α + β y - \overline{α - δ β} = 2δ β.
    \]
    Now, setting $α + δ β = ε^m$ yields the claim.
    \item By the defining equation for $x_m$ and $y_m$ we have
    \begin{align*}
      x_{m + k} + δ y_{m + k} &= ε^{m + k} = (x_m + δ y_m) (x_k + δ y_k) =\\
                            &= (x_m x_k + δ^2 y_m y_k) + δ (x_m y_k + x_k y_m)
    \end{align*}
    and thusly
    \begin{align*}
      x_{m + k} &= x_m x_k + δ^2 y_m y_k, \\
      y_{m + k} &= x_m y_k + x_k y_m.
    \end{align*}
    The identities for $x_{m - k}$ and $y_{m - k}$ follow analogously.
  \end{plist}
\end{proof}

Setting $k = 1$ in the lemma above, one obtains $x_{m ± 1} = a x_m ± δ^2 y_m$
and $y_{m ± 1} = a y_m ± x_m$. A further immediate consequence of this lemma is
the subsequent one, which brings divisibility into play.

\begin{lem}
  Let $K$ be a number field and $a ∈ \algint$ such that $δ = δ(a) \not\in K$.
  Then for all $m, k ∈ ℕ$, $k ≠ 0$ we have
  \begin{thmlist}
    \item $y_m$ divides $y_{mk}$ in $\algint$ and
    \item $y_{mk} \equiv k x_m^{k - 1} y_m \mod \left(y_m^3\right)$ in
    $\algint$ i.e. $y_{mk} - k x_m^{k - 1} y_m$ is contained in the principal
    ideal generated by $y_m^3$ in $\algint$.
  \end{thmlist}
\end{lem}
\begin{proof}
  \begin{plist}
    \item I argue by induction on $k$. The claim is trivial if $k = 1$ and
    \cref{lem:addition formulas} implies that
    \[
      y_{m(k + 1)} = x_m y_{mk} + x{mk} y_m.
    \]

    If the claim is proven for all factors lower than $k + 1$, one finds that
    $y_m \mid y_{mk}$ and $y_m \mid y_m$ trivially. As a consequence, $y_m \mid
    y_{m(k + 1)}.$

    \item Again the defining equation yields
    \begin{align*}
      x_{mk} + δ y_{mk} &= ε^{mk} = (x_m + δ y_m)^k = \\
                        &= \sum_{j = 0}^k \binom k j x_m^{k - j} y_m^j δ^j \\
      \intertext{and}
      y_{mk} &= \sum_{\substack{j=0\\ j \text{ odd}}}^k
                \binom k j x_m^{k - j} y_m^j δ^{j -1}.
    \end{align*}
    In the equation above all terms for $j > 1$ are divisible by $y_m^3$ and
    thus vanish modulo $\left(y_m^3\right)$. The only term remaining is $k
    x_m^{k - 1} y_m$ as claimed.
  \end{plist}
\end{proof}

The next lemma even though being easy to prove provides a valuable tool in
studying the sequences $x_m$ and $y_m$. It derives an recursive definition and
lets one prove properties of the sequences, by proving them for $m ∈ \lbrace
0, 1 \rbrace$ and inferring the properties for $m + 1$ from $m$ and $m - 1$.

\begin{lem} \label{lem:recursion for x_m and y_m}
  Let $K$ be a number field and $a ∈ \algint$ such that $δ = δ(a) \not\in K$.
  For $m > 1$ the following recursive conditions hold.
  \begin{align*}
    x_{m + 1} &= 2 a x_m - x_{m - 1}, & x_1 = a, \;& x_0 = 1 \\
    y_{m + 1} &= 2 a y_m - y_{m - 1}, & y_1 = 1, \;& y_0 = 0 \\
  \end{align*}
\end{lem}
\begin{proof}
  The initial conditions follow from $ε = a + δ$ and $ε^0 = 1$. To prove the
  the difference equations one uses \cref{lem:addition formulas} and obtains
  \begin{align*}
    x_{m + 1} &= a x_m + δ^2 y_m,  &  y_{m + 1} &= a y_m + x_m, \\
    x_{m - 1} &= a x_m - δ^2 y_m,  &  y_{m + 1} &= a y_m - x_m.
  \end{align*}
  Summation yields $x_{m + 1} + x_{m - 1} = 2 a x_m$ and $y_{m + 1} + y_{m - 1}
  = 2 a y_m$.
\end{proof}

One applies the previous lemma to prove some congruence conditions.

\begin{lem}
  Let $K$ be a number field and $a, b, c ∈ \algint$ such that $δ(a), δ(b)
  \not\in K$. Then for all $m ∈ ℕ$ the following congruences hold.
  \begin{plist}
    \item $y_m (a) \equiv m \mod (a - 1)$
    \item If $a \equiv b \mod (c)$, then $x_m (a) \equiv x_m (b) \mod (c)$ and
    $y_m(a) \equiv y_m(b) \mod (c)$.
  \end{plist}
\end{lem}
\begin{proof}
  The first and second congruence become equalities if $m = 0$. As for $m = 1$,
  the first congruence is again an equality as $y_1 (a) = 1$ independently of
  $a$. The second claim is trivial since $x_1 (η) = η$ and $y_1 (η) = 1$ for $η
  ∈ \lbrace a, b \rbrace$. At this point one proceeds inductively and assumes
  the claims to be proven for all indices lower than $m + 1$.

  \begin{plist}
    \item Note that $a \equiv 1 \mod (a - 1)$ and thusly by
    \cref{lem:recursion for x_m and y_m}
    \[
      y_{m + 1} = 2 a y_m - y_{m - 1} \equiv 2 m - (m - 1) = m + 1 \mod (a - 1)
    \]
    as claimed.

    \item Using \cref{lem:recursion for x_m and y_m} we see that for fixed $m$
    the coefficients $x_m (η)$ and $y_m (η)$ can be expressed as some fixed
    polynomial in $η$. For the congruence this means
    \begin{align*}
      x_{m + 1} (a) &= 2 a x_m (a) - x_{m - 1} (a)
                     \equiv 2 b x_m (b) - x_m{m - 1} (b) = x_{m + 1} (b)
                     \mod (c)
    \end{align*}
    and for $y_{m + 1}$ completely analogously.
  \end{plist}
\end{proof}

\begin{lem}
  Let $K$ be a number field and $a ∈ \algint$ such that $δ = δ(a) \not\in K$.
  Then for $m, k ∈ ℕ$ such that $m ± k ≥ 0$ the following congruence holds.
  \[
    x_{2 m ± k} \equiv - x_k(a) \mod (x_m)
  \]
\end{lem}
\begin{proof}
  By applying the addition formulas of \cref{lem:addition formulas} twice and
  using that $x_m$ and $y_m$ solve Pell's equation \eqref{eq:Pell} one obtains
  \begin{align*}
    x_{2m ± k} &= x_m x_{m ± k} + δ^2 y_m y_{m ± k}
                \equiv δ^2 y_m (y_m x_j ± x_m y_j) \\
               &\equiv δ^2 y_m^2 x_j = (x_m^2 - 1) x_j \\
               &\equiv -x_j \mod (x_n).
  \end{align*}
\end{proof}

At this point for the first time in this section I state a result that is no
direct generalisation of a result in \cite{Davis1973} and present a prove given
in \cite{Denef1980}. Note however that the result is nevertheless true for the
case $K = ℚ$ and $\algint = ℤ$.

\begin{lem}
  Let $K$ be a number field and $a ∈ \algint$ such that $δ = δ(a) \not\in K$.
  Then for all $η ∈ \algint \setminus \set{0}$ there exists an $m ∈ ℕ$ such that
  $η \mid y_m$ in $\algint[{K[δ]}]$.
  % QUESTION
  \todo{Can we divide in $\algint$?}
\end{lem}
\begin{proof}
  % QUESTION
  Let $m$ be the order of the group of units in the finite\todo{Why?}{} ring
  $\algint[{K[δ]}]/(2 δ η)$, where $(2 δ η)$ denotes the principal ideal
  generated by $2 δ η$ in $\algint[{K[δ]}]$. Then $ε^{±m} \equiv 1 \mod (2 δ
  η)$. Hence, $2 δ η \mid ε^m - ε^{-m}$ in $\algint[{K[δ]}]$ and therefore
  \[\left. η \;\middle\vert\; \frac{ε^m - ε^{-m}}{2 δ} \right. \]
  in $\algint[{K[δ]}]$, where the right hand side equals $y_m$ by
  \cref{lem:real part of epsilon}.
\end{proof}

% TODO
Before proving the main theorems of this section (\todo{reference them}) I
sketch how \textcite{Davis1973} proceeds in proving that \textsc{H10} is
undecidable over $ℤ$.

First he proves using the sequences above that the exponential function is
Diophantine \cite[Thm 3.3]{Davis1973}. Then he is able to extend the language of
Diophantine predicates by \emph{bounded existential} and \emph{bounded universal
qantifiers} i.e. by
\begin{align*}
  (∃y)_{≤x}ϕ(x, y) &⇔ ∃y\; (y ≤ x ∧ ϕ(x, y)),\\
  (∀y)_{≤x}ϕ(x, y) &⇔ ∀y\; (y > x ∨ ϕ(x, y))
\end{align*}
where $ϕ$ is a positive existential formula \cite[Thm 5.1]{Davis1973}. The first
one is easily seen to be Diophantine as the order relation on $ℕ^{*}$ is
Diophantine. Proving the second claim takes the rest of the section. Now using
this result together with the sequence number theorem \cite[Thm 1.3]{Davis1973}
Davis proofs that a function is Diophantine if and only if it is computable
\cite[Thm 6.1]{Davis1973}.
% TODO
\todo{Finish the exposition why \textsc{H10} is undecidable}

\subsection{Hilbert's tenth problem over totally real number fields}
